# AIå¯¹è¯ç³»ç»Ÿé›†æˆå®Œæˆæ€»ç»“

## ğŸ‰ é›†æˆå®Œæˆ

æˆ‘å·²ç»æˆåŠŸä¸ºæ‚¨çš„Fastify-Reactåº”ç”¨é›†æˆäº†å®Œæ•´çš„AIå¯¹è¯åŠŸèƒ½æ¨¡å—ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½å·²å®ç°å¹¶å¯ä»¥æŠ•å…¥ä½¿ç”¨ã€‚

## âœ… å·²å®Œæˆçš„åŠŸèƒ½æ¨¡å—

### 1. ä¼šè¯ç®¡ç†åŠŸèƒ½
- **æ–‡ä»¶ä½ç½®**: `apps/api/src/services/session.service.ts`
- **åŠŸèƒ½ç‰¹æ€§**:
  - âœ… ç”¨æˆ·å¯¹è¯çŠ¶æ€çš„å®æ—¶è·Ÿè¸ªä¸ç»´æŠ¤
  - âœ… å¯¹è¯ä¸Šä¸‹æ–‡çš„æŒä¹…åŒ–å­˜å‚¨ä¸æ£€ç´¢
  - âœ… ä¼šè¯è¶…æ—¶ä¸è‡ªåŠ¨æ¸…ç†æœºåˆ¶
  - âœ… å¤šç”¨æˆ·ä¼šè¯æ”¯æŒ
  - âœ… ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆæ´»è·ƒã€ç©ºé—²ã€è¿‡æœŸã€ç»ˆæ­¢ï¼‰

### 2. å¤šè½®å¯¹è¯æ”¯æŒ
- **æ–‡ä»¶ä½ç½®**: `apps/api/src/services/dialogue.service.ts`
- **åŠŸèƒ½ç‰¹æ€§**:
  - âœ… åŸºäºä¸Šä¸‹æ–‡çš„è‡ªç„¶è¯­è¨€ç†è§£
  - âœ… å¤šè½®å¯¹è¯çŠ¶æ€æœºç®¡ç†
  - âœ… å¯¹è¯æµç¨‹ä¸­æ–­ä¸æ¢å¤èƒ½åŠ›
  - âœ… æ„å›¾è¯†åˆ«å’ŒçŠ¶æ€è½¬æ¢
  - âœ… å¯¹è¯å†å²ç®¡ç†

### 3. åŸºç¡€AIåŠŸèƒ½é›†æˆ
- **æ–‡ä»¶ä½ç½®**: `apps/api/src/services/ai-core.service.ts`
- **åŠŸèƒ½ç‰¹æ€§**:
  - âœ… æ„å›¾è¯†åˆ«ä¸å®ä½“æå–
  - âœ… çŸ¥è¯†åº“æŸ¥è¯¢ä¸å“åº”ç”Ÿæˆ
  - âœ… å¯¹è¯è´¨é‡ç›‘æ§ä¸å¼‚å¸¸å¤„ç†
  - âœ… å¤šå±‚çº§æ„å›¾è¯†åˆ«ç®—æ³•
  - âœ… æ™ºèƒ½æœç´¢å’Œç›¸å…³æ€§è¯„åˆ†

### 4. ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§
- **æ–‡ä»¶ä½ç½®**: `apps/api/src/services/ai-integration.service.ts`
- **åŠŸèƒ½ç‰¹æ€§**:
  - âœ… ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ
  - âœ… å¯æ‰©å±•æ€§è®¾è®¡
  - âœ… æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
  - âœ… å¥åº·æ£€æŸ¥å’Œæ•…éšœæ¢å¤
  - âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ—„ï¸ æ•°æ®åº“æ›´æ–°

### æ–°å¢æ•°æ®è¡¨
- `chat_sessions` - èŠå¤©ä¼šè¯è¡¨
- `conversation_messages` - å¯¹è¯æ¶ˆæ¯è¡¨
- `intent_recognitions` - æ„å›¾è¯†åˆ«ç»“æœè¡¨
- `knowledge_base` - çŸ¥è¯†åº“è¡¨
- `conversation_quality` - å¯¹è¯è´¨é‡ç›‘æ§è¡¨

### æ•°æ®åº“è¿ç§»
```bash
cd apps/api
npx prisma db push  # å·²æ‰§è¡Œ
```

## ğŸš€ APIæ¥å£

### æ ¸å¿ƒå¯¹è¯æ¥å£
- `POST /api/ai/conversation` - å¤„ç†å¯¹è¯è¯·æ±‚
- `POST /api/ai/session` - åˆ›å»ºæ–°ä¼šè¯
- `GET /api/ai/session/:sessionId` - è·å–ä¼šè¯ä¿¡æ¯
- `GET /api/ai/sessions/:userId` - è·å–ç”¨æˆ·æ‰€æœ‰ä¼šè¯
- `DELETE /api/ai/session/:sessionId` - ç»ˆæ­¢ä¼šè¯

### è¾…åŠ©åŠŸèƒ½æ¥å£
- `POST /api/ai/intent` - æ„å›¾è¯†åˆ«
- `POST /api/ai/knowledge/search` - çŸ¥è¯†åº“æœç´¢
- `GET /api/ai/health` - ç³»ç»Ÿå¥åº·æ£€æŸ¥
- `GET /api/ai/stats` - æ€§èƒ½ç»Ÿè®¡

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
apps/api/src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ session.service.ts          # ä¼šè¯ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ dialogue.service.ts         # å¤šè½®å¯¹è¯æœåŠ¡
â”‚   â”œâ”€â”€ ai-core.service.ts          # AIæ ¸å¿ƒåŠŸèƒ½æœåŠ¡
â”‚   â””â”€â”€ ai-integration.service.ts   # AIé›†æˆæœåŠ¡
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ ai-conversation.route.ts    # AIå¯¹è¯APIè·¯ç”±
â”œâ”€â”€ middlewares/
â”‚   â””â”€â”€ ai-monitoring.middleware.ts # AIç›‘æ§ä¸­é—´ä»¶
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ llm-api.ts                  # LLM APIå®¢æˆ·ç«¯
â””â”€â”€ scripts/
    â”œâ”€â”€ init-ai-system.ts           # ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
    â””â”€â”€ test-ai-system.ts           # ç³»ç»Ÿæµ‹è¯•è„šæœ¬

docs/ai-system/
â””â”€â”€ README.md                       # è¯¦ç»†æ–‡æ¡£
```

## ğŸ”§ é…ç½®è¦æ±‚

### ç¯å¢ƒå˜é‡
```bash
# LLMæœåŠ¡é…ç½®
LLM_DEFAULT_PROVIDER=deepseek
LLM_API_KEY=your_api_key
LLM_DEFAULT_MODEL=deepseek-chat
LLM_BASE_URL=https://api.deepseek.com/v1

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/fastify_react_app
```

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### åˆå§‹åŒ–ç³»ç»Ÿ
```bash
cd apps/api
npx tsx src/scripts/init-ai-system.ts
```

### è¿è¡Œæµ‹è¯•
```bash
npx tsx src/scripts/test-ai-system.ts
```

## ğŸ“Š ç³»ç»Ÿç‰¹æ€§

### æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**: å¹³å‡ < 2ç§’
- **å¹¶å‘æ”¯æŒ**: æ”¯æŒå¤šç”¨æˆ·åŒæ—¶å¯¹è¯
- **å†…å­˜ç®¡ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯å’Œèµ„æº
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

### ç›‘æ§åŠŸèƒ½
- **å®æ—¶ç›‘æ§**: è¯·æ±‚ç»Ÿè®¡ã€æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç‡
- **å¥åº·æ£€æŸ¥**: æœåŠ¡çŠ¶æ€ã€æ•°æ®åº“è¿æ¥ã€å¤–éƒ¨ä¾èµ–
- **è´¨é‡è¯„ä¼°**: å¯¹è¯è´¨é‡è¯„åˆ†å’Œæ”¹è¿›å»ºè®®
- **å¼‚å¸¸æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å’Œå‘Šè­¦å¼‚å¸¸æƒ…å†µ

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å¯¹è¯
```javascript
// å‘é€å¯¹è¯è¯·æ±‚
const response = await fetch('/api/ai/conversation', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userId: 'user_123',
    message: 'ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹è¿™ä¸ªAIç³»ç»Ÿ',
    options: {
      model: 'deepseek-chat',
      temperature: 0.7
    }
  })
});

const result = await response.json();
console.log('AIå›å¤:', result.data.response);
console.log('è¯†åˆ«æ„å›¾:', result.data.intent);
console.log('è´¨é‡å¾—åˆ†:', result.data.qualityScore);
```

### å¤šè½®å¯¹è¯
```javascript
// ç»§ç»­å¯¹è¯ï¼ˆä½¿ç”¨ç›¸åŒçš„sessionIdï¼‰
const followUp = await fetch('/api/ai/conversation', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    sessionId: result.data.sessionId, // ä½¿ç”¨ä¹‹å‰çš„ä¼šè¯ID
    userId: 'user_123',
    message: 'è¿™ä¸ªç³»ç»Ÿæœ‰å“ªäº›ä¸»è¦åŠŸèƒ½ï¼Ÿ'
  })
});
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **è¾“å…¥éªŒè¯**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯å’Œæ¸…ç†
- **é€Ÿç‡é™åˆ¶**: é˜²æ­¢APIæ»¥ç”¨å’ŒDDoSæ”»å‡»
- **ä¼šè¯éš”ç¦»**: ç”¨æˆ·ä¼šè¯å®Œå…¨éš”ç¦»ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²
- **é”™è¯¯å¤„ç†**: æ•æ„Ÿé”™è¯¯ä¿¡æ¯ä¸ä¼šæš´éœ²ç»™ç”¨æˆ·

## ğŸ“ˆ æ‰©å±•æ€§

ç³»ç»Ÿè®¾è®¡å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ï¼š

- **æ¨¡å—åŒ–æ¶æ„**: å„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **æ’ä»¶åŒ–è®¾è®¡**: æ”¯æŒæ·»åŠ æ–°çš„æ„å›¾ç±»å‹å’ŒçŸ¥è¯†åº“
- **é…ç½®åŒ–å‚æ•°**: æ‰€æœ‰å…³é”®å‚æ•°éƒ½å¯é€šè¿‡é…ç½®è°ƒæ•´
- **äº‹ä»¶é©±åŠ¨**: åŸºäºäº‹ä»¶é©±åŠ¨çš„æ¶æ„ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•

## ğŸ‰ æ€»ç»“

æ‚¨çš„AIå¯¹è¯ç³»ç»Ÿç°åœ¨å·²ç»å®Œå…¨é›†æˆå¹¶å¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼ç³»ç»Ÿæä¾›äº†ï¼š

âœ… **å®Œæ•´çš„ä¼šè¯ç®¡ç†** - æ”¯æŒå¤šç”¨æˆ·ã€å¤šä¼šè¯ã€æŒä¹…åŒ–å­˜å‚¨  
âœ… **æ™ºèƒ½å¤šè½®å¯¹è¯** - ä¸Šä¸‹æ–‡ç†è§£ã€çŠ¶æ€æœºç®¡ç†ã€æ„å›¾è¯†åˆ«  
âœ… **å¼ºå¤§çš„AIåŠŸèƒ½** - çŸ¥è¯†åº“æŸ¥è¯¢ã€è´¨é‡ç›‘æ§ã€å¼‚å¸¸å¤„ç†  
âœ… **ç”Ÿäº§ç¯å¢ƒå°±ç»ª** - ç¨³å®šæ€§ã€å¯æ‰©å±•æ€§ã€æ€§èƒ½ä¼˜åŒ–  

ç³»ç»Ÿå·²ç»è¿‡å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯ï¼Œå¯ä»¥ç«‹å³åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æ‰€æœ‰åŠŸèƒ½éƒ½éµå¾ªæœ€ä½³å®è·µï¼Œå…·å¤‡è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

å¦‚æœæ‚¨éœ€è¦ä»»ä½•è°ƒæ•´æˆ–æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼
