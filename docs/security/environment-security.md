# ç¯å¢ƒé…ç½®å®‰å…¨æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†é¡¹ç›®ä¸­ç¯å¢ƒé…ç½®çš„å®‰å…¨æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬å¦‚ä½•å®‰å…¨åœ°ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œé¿å…ç¡¬ç¼–ç å¯†ç å’Œå¯†é’¥ã€‚

## å®‰å…¨é—®é¢˜

### å·²ä¿®å¤çš„é—®é¢˜

1. **ç¡¬ç¼–ç  JWT å¯†é’¥** - ä¹‹å‰ä½¿ç”¨é»˜è®¤å€¼ `"your-super-secret-jwt-key-change-this-in-production"`
2. **ç¡¬ç¼–ç æ•°æ®åº“å¯†ç ** - ä¹‹å‰ä½¿ç”¨ `postgres:postgres`
3. **ç¡¬ç¼–ç è¿æ¥å­—ç¬¦ä¸²** - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ç›´æ¥å†™åœ¨ä»£ç ä¸­
4. **æ•æ„Ÿä¿¡æ¯æ³„éœ²** - é…ç½®æ–‡ä»¶å¯èƒ½è¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

### å®‰å…¨é£é™©

- ğŸ”´ **é«˜é£é™©**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é»˜è®¤å¯†ç 
- ğŸ”´ **é«˜é£é™©**: JWT å¯†é’¥æ³„éœ²å¯¼è‡´èº«ä»½éªŒè¯ç»•è¿‡
- ğŸŸ¡ **ä¸­é£é™©**: æ•°æ®åº“è¿æ¥ä¿¡æ¯æ³„éœ²
- ğŸŸ¡ **ä¸­é£é™©**: API å¯†é’¥ç¡¬ç¼–ç 

## å®‰å…¨è§£å†³æ–¹æ¡ˆ

### 1. å®‰å…¨ç¯å¢ƒç®¡ç†å™¨

é¡¹ç›®ç°åœ¨ä½¿ç”¨ `SecureEnvManager` ç±»æ¥ç®¡ç†ç¯å¢ƒé…ç½®ï¼š

```javascript
import SecureEnvManager from '../utils/env-manager.js';

const envManager = new SecureEnvManager(projectRoot);
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è‡ªåŠ¨ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†é’¥
- ä»æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆç¯å¢ƒé…ç½®
- éªŒè¯ç¯å¢ƒé…ç½®å®Œæ•´æ€§
- ç¡®ä¿æ•æ„Ÿæ–‡ä»¶ä¸è¢«æäº¤

### 2. ç¯å¢ƒé…ç½®æ¨¡æ¿

ä½¿ç”¨æ¨¡æ¿ç³»ç»Ÿæ›¿ä»£ç¡¬ç¼–ç ï¼š

```
config/env-templates/
â”œâ”€â”€ root.env      # æ ¹ç›®å½•é…ç½®æ¨¡æ¿
â”œâ”€â”€ api.env       # API é¡¹ç›®é…ç½®æ¨¡æ¿
â””â”€â”€ web.env       # Web é¡¹ç›®é…ç½®æ¨¡æ¿
```

**æ¨¡æ¿å˜é‡ï¼š**
- `{{JWT_SECRET}}` - è‡ªåŠ¨ç”Ÿæˆçš„ JWT å¯†é’¥
- `{{DB_PASSWORD}}` - è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®åº“å¯†ç 
- `{{API_KEY}}` - è‡ªåŠ¨ç”Ÿæˆçš„ API å¯†é’¥

### 3. å®‰å…¨é…ç½®ç”Ÿæˆ

è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå®‰å…¨çš„ç¯å¢ƒé…ç½®ï¼š

```bash
# ç”Ÿæˆæ‰€æœ‰ç¯å¢ƒé…ç½®æ–‡ä»¶
pnpm run env:generate

# æˆ–ä½¿ç”¨æ¢å¤è„šæœ¬
pnpm run restore
```

### 4. å®‰å…¨æ£€æŸ¥

å®šæœŸè¿è¡Œå®‰å…¨æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥å®‰å…¨é…ç½®é—®é¢˜
pnpm run security:check
```

## ä½¿ç”¨æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

1. **é¦–æ¬¡è®¾ç½®**ï¼š
   ```bash
   pnpm run env:generate
   ```

2. **éªŒè¯é…ç½®**ï¼š
   ```bash
   pnpm run security:check
   ```

3. **å¯åŠ¨å¼€å‘ç¯å¢ƒ**ï¼š
   ```bash
   pnpm run dev
   ```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **è®¾ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   export JWT_SECRET="your-production-jwt-secret"
   export DB_PASSWORD="your-production-db-password"
   export API_KEY="your-production-api-key"
   ```

2. **æˆ–ä½¿ç”¨ .env.secrets æ–‡ä»¶**ï¼š
   ```bash
   # åˆ›å»º .env.secrets æ–‡ä»¶ï¼ˆä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰
   JWT_SECRET="your-production-jwt-secret"
   DB_PASSWORD="your-production-db-password"
   API_KEY="your-production-api-key"
   ```

### å¯†é’¥ç®¡ç†

#### è‡ªåŠ¨ç”Ÿæˆå¯†é’¥

ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹ç±»å‹çš„å¯†é’¥ï¼š

- **JWT å¯†é’¥**: 64 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²
- **æ•°æ®åº“å¯†ç **: 16 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²
- **API å¯†é’¥**: 32 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²

#### è‡ªå®šä¹‰å¯†é’¥

å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰å¯†é’¥ï¼Œå¯ä»¥ï¼š

1. åˆ›å»º `.env.secrets` æ–‡ä»¶ï¼š
   ```bash
   JWT_SECRET="your-custom-jwt-secret"
   DB_PASSWORD="your-custom-db-password"
   API_KEY="your-custom-api-key"
   ```

2. è¿è¡Œé…ç½®ç”Ÿæˆï¼š
   ```bash
   pnpm run env:generate
   ```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬æ§åˆ¶

**å¿…é¡»å¿½ç•¥çš„æ–‡ä»¶ï¼š**
```
.env
.env.local
.env.*.local
.env.secrets
```

**å¯ä»¥æäº¤çš„æ–‡ä»¶ï¼š**
```
config/env-templates/
.env.example
```

### 2. å¯†é’¥è½®æ¢

å®šæœŸè½®æ¢å¯†é’¥ï¼š

```bash
# åˆ é™¤æ—§çš„ .env.secrets æ–‡ä»¶
rm .env.secrets

# é‡æ–°ç”Ÿæˆé…ç½®
pnpm run env:generate
```

### 3. ç¯å¢ƒéš”ç¦»

ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼š

- **å¼€å‘ç¯å¢ƒ**: è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•å¯†é’¥
- **æµ‹è¯•ç¯å¢ƒ**: ç‹¬ç«‹çš„æµ‹è¯•å¯†é’¥
- **ç”Ÿäº§ç¯å¢ƒ**: å¼ºéšæœºå¯†é’¥

### 4. ç›‘æ§å’Œå®¡è®¡

å®šæœŸè¿è¡Œå®‰å…¨æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
pnpm run security:check

# æ£€æŸ¥ä»£ç è´¨é‡
pnpm run check:quality

# è¿è¡Œæ‰€æœ‰æ£€æŸ¥
pnpm run check:all
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨**
   ```
   é”™è¯¯: æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨: config/env-templates/root.env
   è§£å†³: ç¡®ä¿æ¨¡æ¿æ–‡ä»¶å­˜åœ¨äºæ­£ç¡®ä½ç½®
   ```

2. **æƒé™é—®é¢˜**
   ```
   é”™è¯¯: EACCES: permission denied
   è§£å†³: æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œç¡®ä¿æœ‰å†™å…¥æƒé™
   ```

3. **ç¯å¢ƒå˜é‡æœªè®¾ç½®**
   ```
   è­¦å‘Š: ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: JWT_SECRET
   è§£å†³: è¿è¡Œ pnpm run env:generate ç”Ÿæˆé…ç½®
   ```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
DEBUG=env-manager pnpm run env:generate
```

## æ›´æ–°æ—¥å¿—

- **v1.0.0**: åˆå§‹å®‰å…¨é…ç½®ç³»ç»Ÿ
- **v1.1.0**: æ·»åŠ è‡ªåŠ¨å¯†é’¥ç”Ÿæˆ
- **v1.2.0**: æ·»åŠ é…ç½®éªŒè¯åŠŸèƒ½
- **v1.3.0**: æ·»åŠ å®‰å…¨æ£€æŸ¥è„šæœ¬

## ç›¸å…³æ–‡æ¡£

- [å¼€å‘ç¯å¢ƒè®¾ç½®](../development/dev-tools.md)
- [éƒ¨ç½²æŒ‡å—](../deployment/docker.md)
- [å®‰å…¨å®¡è®¡](../security/security-audit.md)
