# ğŸ”§ ä¾¿æ·å®‰å…¨çš„ç¯å¢ƒé…ç½®æ›´æ–°æŒ‡å—

**æ›´æ–°æ—¶é—´**: 2025-01-27  
**é€‚ç”¨ç‰ˆæœ¬**: Fastify-React-App-Enhance v1.0+  
**å®‰å…¨ç­‰çº§**: ğŸŸ¢ å®‰å…¨  

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ä¾¿æ·ä¸”å®‰å…¨çš„æ–¹å¼æ›´æ–°é¡¹ç›®ä¸­çš„ç¯å¢ƒé…ç½®ã€Dockeré…ç½®å’Œå…¶ä»–åŸºç¡€è®¾æ–½é…ç½®ã€‚

### ğŸ¯ ä¸»è¦ç‰¹æ€§

- âœ… **å®‰å…¨ä¼˜å…ˆ**: è‡ªåŠ¨å¤‡ä»½ï¼Œæ”¯æŒå›æ»š
- âœ… **ä¾¿æ·æ“ä½œ**: äº¤äº’å¼ç•Œé¢ï¼Œä¸€é”®æ›´æ–°
- âœ… **å…¨é¢éªŒè¯**: è‡ªåŠ¨éªŒè¯é…ç½®æ­£ç¡®æ€§
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: å®Œæ•´çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- âœ… **é›¶åœæœº**: æ”¯æŒçƒ­æ›´æ–°é…ç½®

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. äº¤äº’å¼é…ç½®æ›´æ–°ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨äº¤äº’å¼é…ç½®æ›´æ–°å·¥å…·
pnpm run config:update
```

è¿™å°†å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ç•Œé¢ï¼Œå¼•å¯¼æ‚¨å®Œæˆé…ç½®æ›´æ–°ï¼š

```
ğŸš€ å¼€å§‹äº¤äº’å¼é…ç½®æ›´æ–°...

è¯·é€‰æ‹©è¦æ›´æ–°çš„é…ç½®ç±»å‹:
1. ç¯å¢ƒå˜é‡é…ç½®
2. Dockeré…ç½®
3. å…¨éƒ¨é…ç½®
4. ä»…éªŒè¯é…ç½®

è¯·è¾“å…¥é€‰æ‹© (1-4): 
```

### 2. å¿«é€Ÿå‘½ä»¤

```bash
# åˆ›å»ºé…ç½®å¤‡ä»½
pnpm run config:backup "before-production-deploy"

# éªŒè¯å½“å‰é…ç½®
pnpm run config:validate

# é‡æ–°ç”Ÿæˆç¯å¢ƒæ–‡ä»¶
pnpm run config:regenerate

# åˆ—å‡ºæ‰€æœ‰å¤‡ä»½
pnpm run config:list

# ä»å¤‡ä»½æ¢å¤
pnpm run config:restore config-backup-2025-01-27T10-30-00-000Z
```

---

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### ğŸ”„ ç¯å¢ƒå˜é‡æ›´æ–°

#### è‡ªåŠ¨æ›´æ–°æ•æ„Ÿä¿¡æ¯

```bash
pnpm run config:update
# é€‰æ‹© "1. ç¯å¢ƒå˜é‡é…ç½®"
```

ç³»ç»Ÿä¼šè¯¢é—®æ‚¨æ˜¯å¦æ›´æ–°ä»¥ä¸‹æ•æ„Ÿä¿¡æ¯ï¼š
- **JWTå¯†é’¥**: ç”¨äºAPIè®¤è¯
- **æ•°æ®åº“å¯†ç **: PostgreSQLæ•°æ®åº“è®¿é—®å¯†ç 
- **Rediså¯†ç **: Redisç¼“å­˜æœåŠ¡å¯†ç 
- **APIå¯†é’¥**: å†…éƒ¨APIè°ƒç”¨å¯†é’¥

#### æ‰‹åŠ¨æ›´æ–°ç‰¹å®šé…ç½®

```bash
# ç›´æ¥ä½¿ç”¨ç¯å¢ƒç®¡ç†å™¨
node tools/scripts/utils/env-manager.js
```

### ğŸ³ Dockeré…ç½®æ›´æ–°

#### æ›´æ–°Docker Composeé…ç½®

```bash
pnpm run config:update
# é€‰æ‹© "2. Dockeré…ç½®"
```

è¿™å°†ï¼š
- é‡æ–°ç”Ÿæˆ `docker-compose.yml`
- ä½¿ç”¨æœ€æ–°çš„å®‰å…¨å¯†é’¥
- æ›´æ–°æœåŠ¡é…ç½®
- éªŒè¯é…ç½®æ­£ç¡®æ€§

#### æ‰‹åŠ¨æ›´æ–°Dockeré…ç½®

```bash
# é‡æ–°ç”ŸæˆDocker Composeæ–‡ä»¶
pnpm run docker:generate
```

### ğŸ” é…ç½®éªŒè¯

#### å…¨é¢é…ç½®æ£€æŸ¥

```bash
pnpm run config:validate
```

éªŒè¯å†…å®¹åŒ…æ‹¬ï¼š
- âœ… ç¯å¢ƒå˜é‡å®Œæ•´æ€§
- âœ… å¿…éœ€é…ç½®é¡¹å­˜åœ¨
- âœ… æ•æ„Ÿä¿¡æ¯å®‰å…¨æ€§
- âœ… Dockeré…ç½®æ­£ç¡®æ€§
- âœ… æ–‡ä»¶æƒé™è®¾ç½®

#### å®‰å…¨æ£€æŸ¥

```bash
pnpm run security:check
```

---

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

æ¯æ¬¡é…ç½®æ›´æ–°å‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½ï¼š

```
âœ… é…ç½®å¤‡ä»½å·²åˆ›å»º: backups/config/config-backup-2025-01-27T10-30-00-000Z-before-env-update
```

å¤‡ä»½åŒ…å«ï¼š
- æ‰€æœ‰ç¯å¢ƒé…ç½®æ–‡ä»¶ (`.env`, `.env.secrets`)
- Dockeré…ç½®æ–‡ä»¶
- é…ç½®æ¨¡æ¿æ–‡ä»¶
- æ—¶é—´æˆ³å’Œæè¿°ä¿¡æ¯

### å›æ»šåŠŸèƒ½

å¦‚æœé…ç½®æ›´æ–°å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
# 1. æŸ¥çœ‹å¯ç”¨å¤‡ä»½
pnpm run config:list

# 2. é€‰æ‹©è¦æ¢å¤çš„å¤‡ä»½
pnpm run config:restore config-backup-2025-01-27T10-30-00-000Z
```

### é…ç½®éªŒè¯

æ›´æ–°åè‡ªåŠ¨éªŒè¯ï¼š
- âœ… ç¯å¢ƒå˜é‡æ ¼å¼æ­£ç¡®
- âœ… å¿…éœ€é…ç½®é¡¹å®Œæ•´
- âœ… æ•æ„Ÿä¿¡æ¯å·²æ›´æ–°
- âœ… æœåŠ¡é…ç½®æœ‰æ•ˆ

---

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

### ç¯å¢ƒé…ç½®æ–‡ä»¶

```
config/
â”œâ”€â”€ env-templates/          # é…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ root.env           # æ ¹ç›®å½•ç¯å¢ƒæ¨¡æ¿
â”‚   â”œâ”€â”€ api.env            # APIé¡¹ç›®ç¯å¢ƒæ¨¡æ¿
â”‚   â””â”€â”€ web.env            # Webé¡¹ç›®ç¯å¢ƒæ¨¡æ¿
â”œâ”€â”€ .env                   # æ ¹ç›®å½•ç¯å¢ƒé…ç½®ï¼ˆç”Ÿæˆï¼‰
â”œâ”€â”€ .env.secrets           # æ•æ„Ÿä¿¡æ¯é…ç½®ï¼ˆç”Ÿæˆï¼‰
â”œâ”€â”€ apps/api/.env          # APIç¯å¢ƒé…ç½®ï¼ˆç”Ÿæˆï¼‰
â””â”€â”€ apps/web/.env          # Webç¯å¢ƒé…ç½®ï¼ˆç”Ÿæˆï¼‰
```

### Dockeré…ç½®æ–‡ä»¶

```
infrastructure/docker/
â”œâ”€â”€ docker-compose.yml           # Docker Composeé…ç½®ï¼ˆç”Ÿæˆï¼‰
â”œâ”€â”€ docker-compose.template.yml  # Docker Composeæ¨¡æ¿
â”œâ”€â”€ fastify.Dockerfile          # APIæœåŠ¡Dockerfile
â””â”€â”€ web.Dockerfile              # WebæœåŠ¡Dockerfile
```

### å¤‡ä»½æ–‡ä»¶

```
backups/config/
â”œâ”€â”€ config-backup-2025-01-27T10-30-00-000Z-before-env-update/
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ .env.secrets
â”‚   â”œâ”€â”€ apps/api/.env
â”‚   â”œâ”€â”€ apps/web/.env
â”‚   â””â”€â”€ infrastructure/docker/docker-compose.yml
â””â”€â”€ config-backup-2025-01-27T11-00-00-000Z-before-docker-update/
    â””â”€â”€ ...
```

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### æ‰¹é‡é…ç½®æ›´æ–°

```bash
# æ›´æ–°æ‰€æœ‰é…ç½®
pnpm run config:update
# é€‰æ‹© "3. å…¨éƒ¨é…ç½®"
```

### è‡ªå®šä¹‰å¤‡ä»½æè¿°

```bash
# åˆ›å»ºå¸¦æè¿°çš„å¤‡ä»½
pnpm run config:backup "before-production-deploy"
```

### ç¯å¢ƒç‰¹å®šé…ç½®

```bash
# å¼€å‘ç¯å¢ƒ
NODE_ENV=development pnpm run config:update

# ç”Ÿäº§ç¯å¢ƒ
NODE_ENV=production pnpm run config:update
```

### è„šæœ¬åŒ–é…ç½®æ›´æ–°

```javascript
// åœ¨è„šæœ¬ä¸­ä½¿ç”¨
import ConfigUpdater from './tools/scripts/automation/config-updater.js';

const updater = new ConfigUpdater(process.cwd());

// æ›´æ–°JWTå¯†é’¥
await updater.updateEnvConfig({
    JWT_SECRET: updater.envManager.generateJwtSecret()
});

// éªŒè¯é…ç½®
updater.validateConfig();
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **éƒ¨ç½²å‰å¤‡ä»½**:
   ```bash
   pnpm run config:backup "before-production-deploy"
   ```

2. **éªŒè¯é…ç½®**:
   ```bash
   pnpm run config:validate
   ```

3. **æµ‹è¯•æœåŠ¡**:
   ```bash
   pnpm run dev:api  # æµ‹è¯•APIæœåŠ¡
   pnpm run dev:web  # æµ‹è¯•WebæœåŠ¡
   ```

### å›¢é˜Ÿåä½œ

1. **ä¸è¦æäº¤æ•æ„Ÿæ–‡ä»¶**:
   - `.env.secrets` å·²æ·»åŠ åˆ° `.gitignore`
   - åªæäº¤é…ç½®æ¨¡æ¿æ–‡ä»¶

2. **å…±äº«é…ç½®æ¨¡æ¿**:
   - æ›´æ–° `config/env-templates/` ä¸­çš„æ¨¡æ¿
   - å›¢é˜Ÿæˆå‘˜è¿è¡Œ `pnpm run config:regenerate`

3. **ç¯å¢ƒéš”ç¦»**:
   - å¼€å‘ç¯å¢ƒä½¿ç”¨å¼€å‘é…ç½®
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç”Ÿäº§é…ç½®

### æ•…éšœæ’é™¤

#### é…ç½®éªŒè¯å¤±è´¥

```bash
# æ£€æŸ¥å…·ä½“é”™è¯¯
pnpm run config:validate

# ä»å¤‡ä»½æ¢å¤
pnpm run config:list
pnpm run config:restore <backup-name>
```

#### æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
pnpm run config:validate

# é‡æ–°ç”Ÿæˆé…ç½®
pnpm run config:regenerate

# æ£€æŸ¥Dockeré…ç½®
pnpm run docker:generate
```

#### æƒé™é—®é¢˜

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la .env*
ls -la apps/*/.env

# ä¿®å¤æƒé™
chmod 600 .env.secrets
chmod 644 .env
```

---

## ğŸ“Š æœ€ä½³å®è·µ

### 1. å®šæœŸæ›´æ–°æ•æ„Ÿä¿¡æ¯

```bash
# æ¯æœˆæ›´æ–°ä¸€æ¬¡æ•æ„Ÿä¿¡æ¯
pnpm run config:update
# é€‰æ‹©æ›´æ–°JWTå¯†é’¥ã€æ•°æ®åº“å¯†ç ç­‰
```

### 2. éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

- [ ] åˆ›å»ºé…ç½®å¤‡ä»½
- [ ] éªŒè¯é…ç½®æ­£ç¡®æ€§
- [ ] è¿è¡Œå®‰å…¨æ£€æŸ¥
- [ ] æµ‹è¯•æœåŠ¡å¯åŠ¨
- [ ] éªŒè¯åŠŸèƒ½æ­£å¸¸

### 3. ç›‘æ§é…ç½®å˜æ›´

```bash
# å®šæœŸæ£€æŸ¥é…ç½®çŠ¶æ€
pnpm run config:validate
pnpm run security:check
```

### 4. æ–‡æ¡£åŒ–é…ç½®å˜æ›´

```bash
# åˆ›å»ºå¸¦æè¿°çš„å¤‡ä»½
pnpm run config:backup "feature-xyz-implementation"
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ›´æ–°ç‰¹å®šç¯å¢ƒå˜é‡ï¼Ÿ

A: ä½¿ç”¨äº¤äº’å¼å·¥å…·ï¼š
```bash
pnpm run config:update
# é€‰æ‹© "1. ç¯å¢ƒå˜é‡é…ç½®"
# é€‰æ‹©è¦æ›´æ–°çš„å…·ä½“å˜é‡
```

### Q: é…ç½®æ›´æ–°åæœåŠ¡æ— æ³•å¯åŠ¨ï¼Ÿ

A: æ£€æŸ¥å¹¶æ¢å¤ï¼š
```bash
pnpm run config:validate  # æ£€æŸ¥é…ç½®
pnpm run config:list      # æŸ¥çœ‹å¤‡ä»½
pnpm run config:restore <backup-name>  # æ¢å¤å¤‡ä»½
```

### Q: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒé—´åŒæ­¥é…ç½®ï¼Ÿ

A: ä½¿ç”¨æ¨¡æ¿å’Œé‡æ–°ç”Ÿæˆï¼š
```bash
# 1. æ›´æ–°é…ç½®æ¨¡æ¿
# 2. é‡æ–°ç”Ÿæˆç¯å¢ƒæ–‡ä»¶
pnpm run config:regenerate
```

### Q: å¤‡ä»½æ–‡ä»¶å ç”¨å¤ªå¤šç©ºé—´ï¼Ÿ

A: å®šæœŸæ¸…ç†æ—§å¤‡ä»½ï¼š
```bash
# æ‰‹åŠ¨åˆ é™¤æ—§å¤‡ä»½
rm -rf backups/config/config-backup-*
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. è¿è¡Œé…ç½®éªŒè¯
3. æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
4. å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†
5. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

*æœ¬æŒ‡å—åŸºäº2025-01-27çš„é…ç½®æ›´æ–°å·¥å…·ç‰ˆæœ¬ç¼–å†™ã€‚*
